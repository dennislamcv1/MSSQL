-- INSERT scripts for DiscountTechDW ETL
-- Assumes data is already present in DiscountTech OLTP database

-- Insert into DimCustomer
INSERT INTO [dbo].[DimCustomer] (CustomerID, FirstName, LastName, Email)
SELECT
    customer_id,
    first_name,
    last_name,
    email
FROM DiscountTech.dbo.Customers;
GO

-- Insert into DimProduct
INSERT INTO [dbo].DimProduct](ProductID, ProductName, Price)
SELECT
    product_id,
    product_name,
    price
FROM DiscountTech.dbo.Products;
GO

-- Insert into DimDate
INSERT INTO [dbo].[DimDate] (DateKey, Date, Year, Quarter, Month, Day, WeekdayName)
SELECT DISTINCT
    CONVERT(INT, FORMAT(d, 'yyyyMMdd')) AS DateKey,
    d AS Date,
    YEAR(d),
    DATEPART(QUARTER, d),
    MONTH(d),
    DAY(d),
    DATENAME(WEEKDAY, d)
FROM (
    SELECT order_date AS d FROM DiscountTech.dbo.Orders
    UNION
    SELECT return_date FROM DiscountTech.dbo.Returns
) AS AllDates;
GO
